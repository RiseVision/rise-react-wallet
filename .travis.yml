language: node_js
node_js:
- lts/*
cache:
  yarn: true
  directories:
  - node_modules
  - "~/.cache/Cypress"
  - build
before_install:
- openssl aes-256-cbc -K $encrypted_63d69a2d54d1_key -iv $encrypted_63d69a2d54d1_iv
  -in cypress/fixtures/accounts.json.enc -out cypress/fixtures/accounts.json -d
- curl -o- -L https://yarnpkg.com/install.sh | bash
- export PATH="$HOME/.yarn/bin:$PATH"
env:
  global:
    - CI=false
    - secure: UAme/V5A6bu56r6dwNj2SEuHard4ukmPr1k5DrddBPp9EQbFwPHQDHgzCZJBg5t1eu0QAaaywilzU5eHC45Pbirhd7B1tKaW7Xl/FfCQZepeOv0ZENtZ/Hid0/JrLGu0DnK3+jWTfdc5WOHDvAjojRw9FLxRlyyaG9hnKLWsDX020QUrEz1etqg2mz5bSPzeGj8kK8fLub/LCX5vTZHQikq2LFIx2LquDw0/A4mLorboBp8QExWp+7XmQrJqEQNI9Hn0sI+xGgJHgjK+HRQ/HtYIJiYvpBcDkq2NobXlrvfDExSdcb4nlEq3wotXPHfkDpMMFL4id9rZPB/TT/qfcQOlK3gYC3asy/Lkd8d/Nm8rNZytf4j62Z/vfFlydDRWox6wtHt1JpkSonLqSPAUGEsFAHH9K1SXbt9gtCobpys0QVIFDUfShMbexBN334383hFKLeshiv5EjoDSSHAiKSD3/OyOTg+HcLmNAFNfg4i6malrOXmRb/s5xSgqH/XR25cBlJYyEYQz2vCdCh8rZqvfyvfe3p2Q/lko0ojdhjYsmTej2F9JUBF1PW9nn0avwFhPZq9RALmex0vXg2AapD5+J0YECO2cRq+tuUDQlFBqAmYvuT2s1Z/HbxI7asrQou/L0trUsLmGRp1lbznxC6oFDjHB9mJ1LlbFxZPjuK8=
jobs:
  include:
  - stage: build
    name: Build
    script:
    - yarn build
  - stage: test
    name: Translations
    script:
    - yarn intl:prepare
    - yarn intl:export
  - stage: test
    name: Unit tests
    script:
    - yarn test-unit:prepare
    - yarn test-unit
  - stage: test
    name: E2E tests
    script:
    - yarn run test-ci
